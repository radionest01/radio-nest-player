<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Radio Nest Player</title>
  <style>
    /* [CSS omitted for brevity — use your existing styling here] */
  </style>
</head>
<body>

<div id="radioNestPlayer" class="dark-theme">
  <div id="liveBadge" class="live-badge">LIVE NOW</div>

  <div class="art-wrapper">
    <img id="albumArt" src="https://i.ibb.co/hFPZYTvM/Fallback-Album-Art.png" alt="Album Art">
    <button id="playPause">▶</button>
  </div>

  <div class="info">
    <h2 id="trackTitle">Radio</h2>
    <p id="trackArtist">Radio</p>
  </div>

  <div class="controls">
    <label for="volume">Volume</label><br>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
  </div>

  <button class="theme-toggle">Toggle Theme</button>
  <a href="https://myradionest.com" target="_blank" class="theme-toggle">Powered By Radio Nest</a>

  <audio id="audio" preload="none"></audio>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const params = new URLSearchParams(window.location.search);
    const streamURL = params.get("stream") || "https://ecpro.myradionest.com:1065/stream";
    const metadataURL = params.get("meta") || "https://ecpro.myradionest.com:1065/status-json.xsl";
    const fallbackLogo = "https://i.ibb.co/hFPZYTvM/Fallback-Album-Art.png";

    const audio = document.getElementById("audio");
    const albumArt = document.getElementById("albumArt");
    const playPause = document.getElementById("playPause");
    const liveBadge = document.getElementById("liveBadge");

    audio.src = streamURL;

    function cleanMetadata(str) {
      return str.replace(/\(.*?\)|\[.*?\]|feat\.|ft\./gi, "").trim();
    }

    function fetchCoverArt(artist) {
      const apiKey = "123";
      const url = `https://www.theaudiodb.com/api/v1/json/${apiKey}/search.php?s=${encodeURIComponent(artist)}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          const image = data?.artists?.[0]?.strArtistThumb || fallbackLogo;
          albumArt.style.opacity = 0;
          setTimeout(() => {
            albumArt.src = image;
            albumArt.onerror = () => { albumArt.src = fallbackLogo; };
            albumArt.style.opacity = 1;
          }, 500);
        })
        .catch(() => {
          albumArt.src = fallbackLogo;
        });
    }

    function updatePlayer() {
      fetch(metadataURL)
        .then(res => res.json())
        .then(data => {
          const raw = data?.icestats?.source?.title || "";
          if (!raw) return;
          let [artist, title] = raw.split(" - ");
          artist = cleanMetadata(artist || "Radio");
          title = cleanMetadata(title || "Radio");
          document.getElementById("trackTitle").textContent = title;
          document.getElementById("trackArtist").textContent = artist;
          fetchCoverArt(artist);
        })
        .catch(() => {
          albumArt.src = fallbackLogo;
        });
    }

    updatePlayer();
    setInterval(updatePlayer, 15000);

    playPause.addEventListener("click", () => {
      if (audio.paused) {
        audio.play().then(() => {
          playPause.textContent = "⏸";
          playPause.classList.add("playing");
          liveBadge.style.display = "inline-block";
          liveBadge.classList.add("glow");
        });
      } else {
        audio.pause();
        playPause.textContent = "▶";
        playPause.classList.remove("playing");
        liveBadge.style.display = "none";
        liveBadge.classList.remove("glow");
      }
    });

    document.getElementById("volume").addEventListener("input", (e) => {
      audio.volume = e.target.value;
    });

    document.querySelector(".theme-toggle").addEventListener("click", () => {
      const player = document.getElementById("radioNestPlayer");
      player.classList.toggle("dark-theme");
      player.classList.toggle("light-theme");
    });
  });
</script>

</body>
</html>
